"use strict";(self.webpackChunkcozdocs=self.webpackChunkcozdocs||[]).push([[503],{1292:(e,r,n)=>{n.d(r,{A:()=>s});const s=n.p+"assets/images/image-5-571d3e5f68ea53fe1389df950d02d1e5.png"},3080:(e,r,n)=>{n.d(r,{A:()=>s});const s=n.p+"assets/images/image-1-2c19d6f6ee059da08959341e2298d6bc.png"},3130:(e,r,n)=>{n.d(r,{A:()=>s});const s=n.p+"assets/images/image-3-bc80d011b0f4765c53997405fc877edd.png"},3470:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"terraform/terraform","title":"Terraform + Azure \u2014 Full Infrastructure Automation","description":"alt text","source":"@site/docs/terraform/terraform.md","sourceDirName":"terraform","slug":"/terraform/","permalink":"/cozdocs/docs/terraform/","draft":false,"unlisted":false,"editUrl":"https://github.com/cozloff/cozdocs/edit/main/docs/terraform/terraform.md","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"sidebar_position":7},"sidebar":"tutorialSidebar","previous":{"title":"Terraform","permalink":"/cozdocs/docs/category/terraform"},"next":{"title":"Redis","permalink":"/cozdocs/docs/category/redis"}}');var t=n(4848),i=n(8453);const o={sidebar_position:7},a="Terraform + Azure \u2014 Full Infrastructure Automation",l={},d=[{value:"\ud83d\udea9 Challenge",id:"-challenge",level:2},{value:"\u26a1 Solution",id:"-solution",level:2},{value:"1. Standardized Terraform Modules",id:"1-standardized-terraform-modules",level:3},{value:"2. Remote State in Blob Storage",id:"2-remote-state-in-blob-storage",level:3},{value:"3. Provisioned Entire Infrastructure with High Velocity:",id:"3-provisioned-entire-infrastructure-with-high-velocity",level:3},{value:"8/30/2025 This Week:",id:"8302025-this-week",level:3},{value:"Terraform Initialize",id:"terraform-initialize",level:3},{value:"Terraform Plan",id:"terraform-plan",level:3},{value:"Terraform Apply",id:"terraform-apply",level:3},{value:"Terraform Destroy",id:"terraform-destroy",level:3},{value:"\ud83c\udfc6 Results",id:"-results",level:2},{value:"\ud83d\udcda Key Takeaways",id:"-key-takeaways",level:2}];function c(e){const r={admonition:"admonition",br:"br",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.header,{children:(0,t.jsx)(r.h1,{id:"terraform--azure--full-infrastructure-automation",children:"Terraform + Azure \u2014 Full Infrastructure Automation"})}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.img,{alt:"alt text",src:n(3080).A+"",width:"1398",height:"724"})}),"\n",(0,t.jsxs)(r.p,{children:["This paper highlights the ",(0,t.jsx)(r.strong,{children:"standardized Terraform modules and terraform state"})," and ",(0,t.jsx)(r.strong,{children:"automated provisioning of our entire application and global infrastructure"}),", signifying the start of ",(0,t.jsx)(r.strong,{children:"complete deployment automation from the hardware up \u2192 SUCCESS!"})]}),"\n",(0,t.jsxs)(r.p,{children:["It also demonstrates why ",(0,t.jsx)(r.strong,{children:"Terraform should be an organizational microservice for infrastructure provisioning"}),", not just scattered scripts or manual portal clicks."]}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsx)(r.h2,{id:"-challenge",children:"\ud83d\udea9 Challenge"}),"\n",(0,t.jsxs)(r.p,{children:["Terraform is powerful, but ",(0,t.jsx)(r.strong,{children:"raw, unstructured configs are not enough"})," for enterprise-scale infrastructure:"]}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"State management issues"}),": Without remote state, multiple users drifted into inconsistent infra states."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Duplication & inefficiency"}),": Hardcoded resources repeated across teams and projects."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Operational overhead"}),": Manual provisioning in the Azure Portal slowed down deployment velocity."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Disagreement on scope"}),": EISB recommended Terraform ",(0,t.jsx)(r.em,{children:"only"})," for infrastructure resources, not administrative resources in Entra \u2014 but full automation requires both."]}),"\n"]}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Solution:"})," build a ",(0,t.jsx)(r.strong,{children:"modular Terraform system"})," with remote state, service segmentation, and reusable patterns that automate provisioning from the ground up."]}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsx)(r.h2,{id:"-solution",children:"\u26a1 Solution"}),"\n",(0,t.jsx)(r.p,{children:"Week 8/30/2025, I introduced several improvements:"}),"\n",(0,t.jsx)(r.h3,{id:"1-standardized-terraform-modules",children:"1. Standardized Terraform Modules"}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.img,{alt:"alt text",src:n(3130).A+"",width:"235",height:"377"})}),"\n",(0,t.jsxs)(r.p,{children:["Organized the Terraform code into ",(0,t.jsx)(r.strong,{children:"modules per resource type"})," (e.g., Managed Identities, Resource groups, Key Vault, MongoDB, Redis, Container Apps).",(0,t.jsx)(r.br,{}),"\n","This gave us a ",(0,t.jsx)(r.strong,{children:"clean abstraction layer"})," and allows references across environments, without having to provide all the implementation details in the main file."]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-hcl",children:'# Ex. MongoDB Cluster\nmodule "mongo_cluster" {\n    source              = "./modules/mongo_cluster"\n    resource_group_name = module.resource_group.resource_group_name\n    location            = module.resource_group.location\n    mongodb_username    = var.mongodb_username\n    mongodb_password    = var.mongodb_password\n    tag                 = var.tag\n}\n'})}),"\n",(0,t.jsxs)(r.p,{children:["Used ",(0,t.jsx)(r.strong,{children:"Loops"})," and ",(0,t.jsx)(r.strong,{children:"Conditionals"})," for automation, only made possible by IaC!"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-hcl",children:'  # Ex. App Roles\n  dynamic "app_role" {\n    for_each = var.roles\n    content {\n      id                   = random_uuid.role_ids[app_role.key].result\n      value                = app_role.value\n      display_name         = title(app_role.key)\n      description          = "${title(app_role.key)} role"\n      allowed_member_types = [Classified]\n      enabled              = true\n    }\n  }\n'})}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsx)(r.h3,{id:"2-remote-state-in-blob-storage",children:"2. Remote State in Blob Storage"}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.img,{alt:"alt text",src:n(1292).A+"",width:"848",height:"279"})}),"\n",(0,t.jsxs)(r.p,{children:["Provisioned ",(0,t.jsx)(r.strong,{children:"Azure Blob Storage"})," to host Terraform state for every major component.",(0,t.jsx)(r.br,{}),"\n","This guarantees all engineers share the ",(0,t.jsx)(r.strong,{children:"same tfstate"})," and prevents conflicts during apply/destroy operations."]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-hcl",children:'terraform {\n  backend "azurerm" {\n    resource_group_name   = [Classified]\n    storage_account_name  = [Classified]\n    container_name        = [Classified]\n    key                   = "terraform.tfstate"\n  }\n}\n'})}),"\n",(0,t.jsxs)(r.p,{children:["Created ",(0,t.jsx)(r.strong,{children:"separate blobs"})," for key stacks, provisioned from a centralized ",(0,t.jsx)(r.strong,{children:"terraform state blob hub"}),"."]}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:"Terraform State Hub"}),"\n",(0,t.jsx)(r.li,{children:"Azure Container Registry"}),"\n",(0,t.jsxs)(r.li,{children:["Operations Stack","\n",(0,t.jsxs)(r.ol,{children:["\n",(0,t.jsx)(r.li,{children:"Container Apps Environment"}),"\n",(0,t.jsx)(r.li,{children:"Loki Infrastructure"}),"\n",(0,t.jsx)(r.li,{children:"Grafana Infrastructure"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(r.li,{children:"App Infrastructure (Container Apps, Mongo, Key Vault, Entra, Redis, etc.)"}),"\n"]}),"\n",(0,t.jsx)(r.p,{children:"Referencing global infrastructure using data blocks:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-hcl",children:'#Ex. Global container apps environment\ndata "azurerm_container_app_environment" "aca_env" {\n  name                = [Classified]\n  resource_group_name = [Classified]\n}\n'})}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsx)(r.h3,{id:"3-provisioned-entire-infrastructure-with-high-velocity",children:"3. Provisioned Entire Infrastructure with High Velocity:"}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsx)(r.h3,{id:"8302025-this-week",children:"8/30/2025 This Week:"}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.strong,{children:"Flow executed successfully:"})}),"\n",(0,t.jsxs)(r.ol,{children:["\n",(0,t.jsx)(r.li,{children:"\u2705 Review Code"}),"\n",(0,t.jsx)(r.li,{children:"\u2705 Provision tfstate blobs"}),"\n",(0,t.jsx)(r.li,{children:"\u2705 Provision ACR"}),"\n",(0,t.jsx)(r.li,{children:"\u2705 Provision Operations Stack"}),"\n",(0,t.jsx)(r.li,{children:"\u2705 Provision App"}),"\n",(0,t.jsx)(r.li,{children:"\u2705 Destroy it all"}),"\n",(0,t.jsx)(r.li,{children:"\u2705 Rebuild it all again"}),"\n"]}),"\n",(0,t.jsx)(r.h3,{id:"terraform-initialize",children:"Terraform Initialize"}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.img,{alt:"alt text",src:n(5223).A+"",width:"857",height:"347"})}),"\n",(0,t.jsx)(r.h3,{id:"terraform-plan",children:"Terraform Plan"}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.img,{alt:"alt text",src:n(5726).A+"",width:"1427",height:"588"})}),"\n",(0,t.jsx)(r.h3,{id:"terraform-apply",children:"Terraform Apply"}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.img,{alt:"alt text",src:n(5113).A+"",width:"2107",height:"856"})}),"\n",(0,t.jsx)(r.h3,{id:"terraform-destroy",children:"Terraform Destroy"}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.img,{alt:"alt text",src:n(8864).A+"",width:"1313",height:"1022"})}),"\n",(0,t.jsxs)(r.p,{children:["This demonstrates ",(0,t.jsx)(r.strong,{children:"end-to-end automation"}),": from initial infra creation to safe teardown, without manual portal interaction."]}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsx)(r.h2,{id:"-results",children:"\ud83c\udfc6 Results"}),"\n",(0,t.jsxs)(r.admonition,{title:"Deployment Gain",type:"tip",children:[(0,t.jsx)(r.p,{children:(0,t.jsx)(r.strong,{children:"Never again do you have to click through the Azure Portal to:"})}),(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:"Register apps in Entra"}),"\n",(0,t.jsx)(r.li,{children:"Spin up container apps or resource groups"}),"\n",(0,t.jsx)(r.li,{children:"Manually delete resources in order"}),"\n"]}),(0,t.jsx)(r.p,{children:"All of this is automated, reusable, and idempotent."})]}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Consistency"}),": Remote state ensures every engineer works from the same source of truth."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Scalability"}),": Global services (Kubernetes, Kafka, ACA env) can be referenced by app stacks."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Velocity"}),": New environments can be provisioned in minutes, not days."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Revolutionary UX"}),": Infrastructure provisioning is now self-service, reusable, and future-proof."]}),"\n"]}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsx)(r.h2,{id:"-key-takeaways",children:"\ud83d\udcda Key Takeaways"}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Build on Terraform, don\u2019t just call Azure manually."}),(0,t.jsx)(r.br,{}),"\n","The ",(0,t.jsx)(r.strong,{children:"Azure Portal"})," is powerful but ",(0,t.jsx)(r.strong,{children:"manual"})," \u2014 organizations need ",(0,t.jsx)(r.strong,{children:"IaC microservices"})," to make infra consumable at scale."]}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Terraform + Azure Blob remote state is the best fit"}),": ",(0,t.jsx)(r.strong,{children:"modular"}),", ",(0,t.jsx)(r.strong,{children:"team-safe"}),", and deeply integrated with cloud-native workflows."]}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Optimize once, reuse everywhere."}),(0,t.jsx)(r.br,{}),"\n",(0,t.jsx)(r.strong,{children:"Infrastructure automation"})," should live in a ",(0,t.jsx)(r.strong,{children:"shared service"}),", not in every engineer\u2019s local scripts."]}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsx)(r.admonition,{title:"Other Contributors",type:"info",children:(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Minh Phan"})," \u2014 Standardized resource naming conventions, as well as partnered in architecting our cloud infrastructure. Made a managed identity that allowed me remote access to the tfstate."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Kelly Lee & Cliff Goto"})," \u2014 Alignment on Terraform usage for infra vs administrative resources"]}),"\n"]})})]})}function h(e={}){const{wrapper:r}={...(0,i.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},5113:(e,r,n)=>{n.d(r,{A:()=>s});const s=n.p+"assets/images/image-8-8ee4a3d0117326e783571469ffd648c5.png"},5223:(e,r,n)=>{n.d(r,{A:()=>s});const s=n.p+"assets/images/image-6-98980e7fdf86d16b0c1c1d1ef285e577.png"},5726:(e,r,n)=>{n.d(r,{A:()=>s});const s=n.p+"assets/images/image-7-5a9c3038aaf25436abd462f40a1ff932.png"},8453:(e,r,n)=>{n.d(r,{R:()=>o,x:()=>a});var s=n(6540);const t={},i=s.createContext(t);function o(e){const r=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function a(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),s.createElement(i.Provider,{value:r},e.children)}},8864:(e,r,n)=>{n.d(r,{A:()=>s});const s=n.p+"assets/images/image-9-97a4162995c3d25a32cb390bf2fe400a.png"}}]);